<!DOCTYPE html>
<html>

<head>
    <title>Python to OpenAI function specification converter</title>
    <meta charset="utf-8">
    <style>
        #container {
            display: flex;
            flex-direction: row;
            height: 100%;
            width: 100%;
        }

        #editor_container,
        #result_container {
            flex-grow: 1;
            height: 100%;
            width: 50%;
            flex-basis: auto;
        }
    </style>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <script>
        function setup() {
            import("./codemirror.js").then((module) => {
                basicSetup = window.CM["codemirror"].basicSetup
                EditorView = window.CM["@codemirror/view"].EditorView
                keymap = window.CM["@codemirror/view"].keymap
                indentWithTab = window.CM["@codemirror/commands"].indentWithTab
                python = window.CM["@codemirror/lang-python"].python

                const doc = '"Type in your function declaration here..."'

                editor = new EditorView({
                    doc,
                    extensions: [
                        basicSetup,
                        keymap.of([indentWithTab]),
                        python()
                    ],
                    parent: document.getElementById("editor")
                })

                const intervalTime = 1000;
                let lastVal = "";
                let isLoaded = false;

                function loadPyodideIfNeeded() {
                    if (!isLoaded) {
                        globalThis.loadPyodide();
                        isLoaded = true;
                    }
                }

                function validate() {
                    loadPyodideIfNeeded()
                    const val = editor.state.doc.toString();
                    if (val !== lastVal) {
                        lastVal = val;
                        pyscript.interpreter.run("validate(" + JSON.stringify(val) + ")");
                    }
                }

                setInterval(validate, intervalTime);
            });
        }
    </script>
    <script defer onload="setup()" src="https://pyscript.net/latest/pyscript.js"></script>
</head>

<body>
    <h1>py2gpt<h1>
            <h2>Python to OpenAI function specification converter</h2>
            <div id="container">
                <div id="editor_container">
                    <div id="editor" style="width:100%;height:100%;"></div>
                </div>
                <div id="result_container">
                    <iframe id="result" srcdoc="" style="width:100%;height:100%;" frameborder="0"></iframe>
                </div>
            </div>
            <py-script src="main.py"></py-script>
            <py-config>
                packages = ["docstring_parser", "rich"]
            </py-config>
</body>

</html>
